
{
  "entities": {
    "UserProfile": {
      "title": "User Profile",
      "description": "Represents a user's profile in the system. Can be an 'etudiant', 'formateur', or 'admin'.",
      "type": "object",
      "properties": {
        "name": { "type": "string", "description": "The user's full name." },
        "email": { "type": "string", "format": "email", "description": "The user's email address." },
        "photoURL": { "type": "string", "format": "uri", "description": "URL of the user's profile picture." },
        "createdAt": { "type": "string", "format": "date-time" },
        "formationId": { "type": "string", "description": "The ID of the formation the user is associated with (e.g., 'python', 'sante')." },
        "role": { "type": "string", "enum": ["etudiant", "formateur", "admin"] },
        "xp": { "type": "number", "description": "Experience points for gamification." },
        "badges": { "type": "array", "items": { "type": "string" } },
        "friends": { "type": "array", "items": { "type": "string" }, "description": "List of user UIDs who are friends with this user." },
        "status": { "type": "string", "enum": ["actif", "suspendu"] },
        "infractions": { "type": "number", "description": "A count of user infractions against community guidelines." },
        "scoreReputation": { "type": "number", "description": "A calculated score representing user's reputation." }
      },
      "required": ["name", "email", "createdAt", "role"]
    },
    "InstructorProfile": {
      "title": "Instructor Profile",
      "description": "Extends UserProfile with instructor-specific fields. This is merged into the UserProfile entity when role is 'formateur'.",
      "type": "object",
      "allOf": [{ "$ref": "#/entities/UserProfile" }],
      "properties": {
        "specialite": { "type": "string", "description": "The instructor's area of specialization." },
        "headline": { "type": "string", "description": "A professional headline for the instructor." },
        "videoUrl": { "type": "string", "format": "uri" },
        "socialLinks": {
          "type": "object",
          "properties": {
            "facebookUrl": { "type": "string", "format": "uri" },
            "instagramUrl": { "type": "string", "format": "uri" },
            "twitterUrl": { "type": "string", "format": "uri" },
            "youtubeUrl": { "type": "string", "format": "uri" }
          }
        },
        "validation_status": { "type": "string", "enum": ["incomplete", "pending", "validated", "rejected"] },
        "score_validation": { "type": "number", "description": "The validation score calculated by the AI." },
        "derniere_mise_a_jour": { "type": "string", "format": "date-time" },
        "charteAcceptee": { "type": "boolean" }
      },
      "required": ["validation_status", "charteAcceptee"]
    },
    "Course": {
      "title": "Formation (Course)",
      "description": "Represents a course on the platform. Includes aggregated statistics.",
      "type": "object",
      "properties": {
        "title": { "type": "string" },
        "summary": { "type": "string" },
        "categoryId": { "type": "string" },
        "keywords": { "type": "array", "items": { "type": "string" } },
        "coverUrl": { "type": "string", "format": "uri" },
        "authorId": { "type": "string" },
        "price": { "type": "number" },
        "published": { "type": "boolean" },
        "createdAt": { "type": "string", "format": "date-time" },
        "updatedAt": { "type": "string", "format": "date-time" },
        "statut": { "type": "string", "enum": ["brouillon", "en_attente", "approuvee", "rejetee"] },
        "motifRejet": { "type": "string" },
        "dateValidation": { "type": "string", "format": "date-time" },
        "enrolledCount": { "type": "number", "description": "Maintained by Cloud Function. Total number of enrolled students." },
        "totalViews": { "type": "number", "description": "Maintained by Cloud Function. Sum of all video views in this course." },
        "totalWatchMinutes": { "type": "number", "description": "Maintained by Cloud Function. Sum of all minutes watched in this course." },
        "averageCompletionRate": { "type": "number", "description": "Maintained by Cloud Function. Average completion percentage across all enrollments." }
      },
      "required": ["title", "summary", "categoryId", "authorId", "createdAt", "updatedAt", "price", "published", "statut"]
    },
    "Module": {
      "title": "Module", "type": "object",
      "properties": {
        "title": { "type": "string" }, "summary": { "type": "string" },
        "order": { "type": "number" }, "courseId": { "type": "string" },
        "createdAt": { "type": "string", "format": "date-time" },
        "updatedAt": { "type": "string", "format": "date-time" }
      },
      "required": ["title", "order", "courseId", "createdAt", "updatedAt"]
    },
    "Video": {
      "title": "Video", "type": "object",
      "properties": {
        "title": { "type": "string" }, "duration": { "type": "number" },
        "driveUrl": { "type": "string", "format": "uri" },
        "embedUrl": { "type": "string", "format": "uri" },
        "thumbnailUrl": { "type": "string", "format": "uri" },
        "platform": { "type": "string", "enum": ["youtube", "drive", "other"] },
        "videoId": { "type": "string" }, "order": { "type": "number" },
        "moduleId": { "type": "string" }, "createdAt": { "type": "string", "format": "date-time" },
        "published": { "type": "boolean" },
        "views": { "type": "number", "description": "Maintained by Cloud Function." },
        "totalWatchMinutes": { "type": "number", "description": "Maintained by Cloud Function." }
      },
      "required": ["title", "order", "moduleId", "createdAt", "published", "driveUrl", "embedUrl", "platform"]
    },
    "Enrollment": {
      "title": "Enrollment",
      "description": "Represents a student's enrollment in a course.",
      "type": "object",
      "properties": {
        "studentId": { "type": "string" },
        "studentName": { "type": "string" },
        "courseId": { "type": "string" },
        "courseTitle": { "type": "string" },
        "enrollmentDate": { "type": "string", "format": "date-time" },
        "progression": { "type": "number", "description": "Overall course progress (0-100)." },
        "watchMinutes": { "type": "number", "description": "Total minutes watched by this user for this course." },
        "lastSeenAt": { "type": "string", "format": "date-time" },
        "modules": { "type": "object", "additionalProperties": { "$ref": "#/entities/ModuleProgress" } }
      },
      "required": ["studentId", "studentName", "courseId", "courseTitle", "enrollmentDate", "progression"]
    },
    "ModuleProgress": {
      "title": "Module Progress", "type": "object",
      "properties": {
        "progress": { "type": "number" },
        "videos": { "type": "object", "additionalProperties": { "$ref": "#/entities/VideoProgress" } }
      }
    },
    "VideoProgress": {
      "title": "Video Progress", "type": "object",
      "properties": {
        "watched": { "type": "boolean" }, "watchedAt": { "type": "string", "format": "date-time" },
        "lastPosition": { "type": "number", "description": "Last playback position in seconds." },
        "watchMinutes": { "type": "number" }
      }
    },
    "Donation": {
      "title": "Donation", "type": "object",
      "properties": {
        "donateurId": { "type": "string" }, "donateurNom": { "type": "string" },
        "donateurEmail": { "type": "string", "format": "email" }, "montant": { "type": "number" },
        "devise": { "type": "string" }, "date": { "type": "string", "format": "date-time" },
        "statut": { "type": "string", "enum": ["succes", "en_attente", "echec"] },
        "moyenPaiement": { "type": "string", "enum": ["carte", "mobile_money", "inconnu"] },
        "paysOrigine": { "type": "string" }, "courseId": { "type": "string" },
        "transactionId": { "type": "string" }
      },
      "required": ["donateurId", "donateurNom", "donateurEmail", "montant", "devise", "date", "statut"]
    },
    "UserActivityLog": {
      "title": "User Activity Log", "type": "object",
      "properties": {
        "userId": { "type": "string" }, "name": { "type": "string" }, "role": { "type": "string" },
        "action": { "type": "string" }, "details": { "type": "string" },
        "timestamp": { "type": "string", "format": "date-time" },
        "status": { "type": "string", "enum": ["succes", "echec"] }
      },
      "required": ["userId", "name", "role", "action", "timestamp", "status"]
    },
    "AdminNotification": {
      "title": "Admin Notification", "type": "object",
      "properties": {
        "type": { "type": "string", "enum": ["nouveau_cours", "nouveau_paiement", "nouvelle_inscription", "modification_profil", "demande_validation", "possible_scam"] },
        "title": { "type": "string" }, "message": { "type": "string" },
        "createdAt": { "type": "string", "format": "date-time" }, "read": { "type": "boolean" },
        "link": { "type": "string", "format": "uri" }
      },
      "required": ["type", "title", "message", "createdAt", "read"]
    },
    "InstructorRequest": {
      "title": "Instructor Request", "type": "object",
      "properties": {
        "userId": { "type": "string" }, "userName": { "type": "string" }, "userEmail": { "type": "string", "format": "email" },
        "requestDate": { "type": "string", "format": "date-time" },
        "status": { "type": "string", "enum": ["pending", "approved", "rejected", "éligible", "en_attente", "refusé"] },
        "specialite": { "type": "string" }, "motivation": { "type": "string" },
        "videoUrl": { "type": "string", "format": "uri" },
        "socialLinks": {
          "type": "object", "properties": {
            "facebookUrl": { "type": "string", "format": "uri" },
            "instagramUrl": { "type": "string", "format": "uri" },
            "twitterUrl": { "type": "string", "format": "uri" },
            "youtubeUrl": { "type": "string", "format": "uri" }
          }
        }, "scoreReputation": { "type": "number" }, "scoreFinal": { "type": "number" },
        "feedbackMessage": { "type": "string" }, "badge": { "type": "string" }
      },
      "required": ["userId", "userName", "userEmail", "requestDate", "status", "specialite", "motivation", "videoUrl"]
    },
    "Chat": {
      "title": "Chat", "type": "object",
      "properties": {
        "members": { "type": "array", "items": { "type": "string" } },
        "lastMessage": { "type": "string" }, "lastTimestamp": { "type": "string", "format": "date-time" },
        "unreadCounts": { "type": "object", "additionalProperties": { "type": "number" } },
        "formationId": { "type": "string" }
      },
      "required": ["members", "lastTimestamp", "formationId"]
    },
    "Message": {
      "title": "Message", "type": "object",
      "properties": {
        "from": { "type": "string" }, "text": { "type": "string" },
        "attachments": { "type": "array", "items": { "type": "string", "format": "uri" } },
        "timestamp": { "type": "string", "format": "date-time" }, "seen": { "type": "boolean" },
        "auto": { "type": "boolean" }
      },
      "required": ["from", "text", "timestamp", "seen"]
    },
    "InstructorStats": {
      "title": "Instructor Stats",
      "description": "Aggregated statistics for a specific instructor, updated by Cloud Functions.",
      "type": "object",
      "properties": {
        "totalCourses": { "type": "number" },
        "totalStudents": { "type": "number" },
        "totalRevenue": { "type": "number" },
        "totalWatchMinutes": { "type": "number" },
        "lastUpdated": { "type": "string", "format": "date-time" }
      },
      "required": ["totalCourses", "totalStudents", "totalRevenue", "totalWatchMinutes", "lastUpdated"]
    },
    "DailyAnalytics": {
      "title": "Daily Analytics",
      "description": "Daily aggregated metrics for a specific course, updated by Cloud Functions.",
      "type": "object",
      "properties": {
        "date": { "type": "string", "format": "date" },
        "courseId": { "type": "string" },
        "newEnrollments": { "type": "number" },
        "videoViews": { "type": "number" },
        "watchMinutes": { "type": "number" },
        "donationsAmount": { "type": "number" },
        "revenueAmount": { "type": "number" }
      },
      "required": ["date", "courseId", "newEnrollments", "videoViews", "watchMinutes", "donationsAmount", "revenueAmount"]
    }
  },
  "firestore": {
    "users/{userId}": { "schema": { "$ref": "#/entities/UserProfile" } },
    "users/{userId}/enrollments/{courseId}": { "schema": { "$ref": "#/entities/Enrollment" } },
    "users/{userId}/wishlist/{wishlistId}": { "schema": { "type": "object", "properties": { "courseId": { "type": "string" } } } },
    "instructor_requests/{uid}": { "schema": { "$ref": "#/entities/InstructorRequest" } },
    "categories/{categoryId}": { "schema": { "type": "object", "properties": { "name": { "type": "string" } } } },
    "formations/{formationId}": { "schema": { "$ref": "#/entities/Course" } },
    "formations/{formationId}/modules/{moduleId}": { "schema": { "$ref": "#/entities/Module" } },
    "formations/{formationId}/modules/{moduleId}/videos/{videoId}": { "schema": { "$ref": "#/entities/Video" } },
    "formations/{formationId}/enrollments/{enrollmentId}": { "schema": { "$ref": "#/entities/Enrollment" } },
    "donations/{donationId}": { "schema": { "$ref": "#/entities/Donation" } },
    "chats/{chatId}": { "schema": { "$ref": "#/entities/Chat" } },
    "chats/{chatId}/messages/{messageId}": { "schema": { "$ref": "#/entities/Message" } },
    "notifications/{notificationId}": { "schema": { "type": "object", "properties": {} } },
    "moderationLogs/{logId}": { "schema": { "$ref": "#/entities/ModerationLog" } },
    "aiFlags/{flagId}": { "schema": { "$ref": "#/entities/AiFlag" } },
    "moderationAppeals/{appealId}": { "schema": { "$ref": "#/entities/ModerationAppeal" } },
    "embeddings/{embeddingId}": { "schema": { "$ref": "#/entities/Embedding" } },
    "tutorFeedbacks/{feedbackId}": { "schema": { "$ref": "#/entities/TutorFeedback" } },
    "formateur_stats/{authorId}": {
      "schema": { "$ref": "#/entities/InstructorStats" },
      "description": "Stores aggregated real-time statistics for each instructor."
    },
    "analytics/{courseId}/daily_stats/{date_YYYY_MM_DD}": {
      "schema": { "$ref": "#/entities/DailyAnalytics" },
      "description": "Stores daily aggregated metrics for a specific course."
    }
  },
  "indexing": {
    "recommendations": [
        "Recommander de créer un index composite pour la collection 'formations' sur les champs 'authorId' et 'createdAt' pour permettre aux formateurs de trier leurs cours par date.",
        "Recommander de créer un index composite pour la collection 'formations' sur les champs 'categoryId' et 'published' pour filtrer et afficher rapidement les cours publiés par catégorie.",
        "Recommander de créer un index composite pour la collection 'friendRequests' sur les champs 'from' et 'to' pour vérifier efficacement les demandes existantes.",
        "Recommander de créer un index composite pour la collection 'chats' sur le champ 'members' pour rechercher des conversations entre utilisateurs."
    ]
  },
  "examples": [
    {
        "path": "courses/exampleCourse123",
        "document": {
          "title": "Introduction à l'IA",
          "authorId": "formateurUID1",
          "published": true,
          "price": 0,
          "createdAt": "2024-05-10T10:00:00Z",
          "enrolledCount": 150,
          "totalViews": 1250,
          "totalWatchMinutes": 7500
        }
    },
    {
        "path": "analytics/exampleCourse123/daily_stats/2024-05-10",
        "document": {
          "date": "2024-05-10",
          "courseId": "exampleCourse123",
          "newEnrollments": 12,
          "videoViews": 240,
          "watchMinutes": 1500,
          "donationsAmount": 50,
          "revenueAmount": 0
        }
    },
    {
        "path": "formateur_stats/formateurUID1",
        "document": {
          "authorId": "formateurUID1",
          "totalCourses": 5,
          "totalStudents": 450,
          "totalRevenue": 1230.50,
          "totalWatchMinutes": 35000,
          "lastUpdated": "2024-05-10T14:30:00Z"
        }
    }
  ]
}
